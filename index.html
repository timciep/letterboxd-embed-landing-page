<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <title>Letterboxd Diary Embed</title>

    <meta name="description" content="Embed your Letterboxd diary on your website.">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

    <script src="//unpkg.com/alpinejs" defer></script>
    <script type="module" src="/src/main.ts"></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GF6K11067Q"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-GF6K11067Q');
    </script>
  </head>

  <body class="bg-shark-950 text-shark-100">
    <style>
      .letterboxd-embed-tc-more {
        color: blue;
        text-decoration: underline;
      }
    </style>

    <div class="text-center mt-8 mb-6 mx-2">
      <h1 class="text-3xl md:text-4xl font-bol">
        <span class="">Letterboxd</span>
        Diary Embed
      </h1>

      <p class="text-lg text-shark-200 mt-2">
        Embed your
        <a href="https://letterboxd.com" target="_blank" class="text-apple-400 hover:text-apple-200">
          Letterboxd
        </a>
        diary on your&nbsp;website.
      </p>

      <p class="text-xs text-shark-300 mt-3">
        (Created by a fan. Not officially affiliated with Letterboxd.)
      </p>
    </div>

    <div class="mx-5 text-center" x-data="data">
      <div class="">
        <label for="lb-un">Enter your username:</label>
      </div>
      
      <div class="mt-2">
        <input 
          x-model="username"
          @keyup.enter="submit"
          @input="snippet = ''"
          id="lb-un" 
          type="text" 
          class="rounded text-lg p-2 w-full max-w-sm text-center text-shark-900 bg-shark-100"
        >
      </div>

      <div class="mt-3">
        <button 
          @click="submit()"
          id="submit" 
          class="rounded bg-orange-800 hover:bg-orange-900 text-shark-100 p-2 w-full max-w-xs"
        >
          Generate embed code
        </button>
      </div>

      <div class="max-w-screen-lg mx-auto"
        x-show="snippet"
        x-cloak
      >
        <div class="my-8">
          <hr class="border-shark-800">
        </div>

        <div class="flex w-full justify-between gap-5 flex-col md:flex-row">
          <div>
            <div class="max-w-sm mx-auto text-center">
              <label for="code">
                Paste the snippet below into your website, where you want your diary to appear:
              </label>
            </div>
    
            <div class="mt-3">
              <textarea 
                @click="$event.target.select()"
                id="code" 
                class="rounded text-xs p-2 w-full text-left text-shark-900 bg-shark-100 h-44"
                rows="5"
                x-model="snippet"
              ></textarea>
            </div>

            <div class="mt-4 text-sm text-shark-300">
              Note: Embed may take up to 1 hour to update after you add a new diary entry.
            </div>
          </div>

          <div class="basis-6/12">
            <div class="text-center mx-auto text-lg">
              Preview:
            </div>
  
            <div class="mt-3 py-5 px-2 bg-white rounded text-black">
              <div x-show="previewHtmlLoading" class="text-center italic">
                Loading...
              </div>

              <div x-show="previewHtml" x-html="previewHtml"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="my-12 mx-2 text-shark-300 text-sm">
      <div class="flex gap-5 justify-center items-center">
        <div>
          Created by
          <a 
            href="https://www.timcieplowski.com/" target="blank"
            class="text-blue-300 hover:text-blue-200"
          >
            Tim Cieplowski
          </a>
        </div>

        <div>
          <a class="bg-blue-300 hover:bg-blue-200 rounded p-2 text-blue-800"
            target="_blank"
            href="https://ko-fi.com/timciep"
          >â˜• Buy me a coffee</a>
        </div>

      </div>
      
      <div class="mt-6 text-center">
        <a class="inline-block w-6" href="https://github.com/timciep/letterboxd-embed-landing-page" target="_blank">
          <svg aria-label="GitHub" viewBox="0 0 98 96" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z" fill="#9eb6c2"/></svg>
        </a>
      </div>
    </div>

    <script>
      const baseUrl = 'https://lb-embed-content.bokonon.dev';
      // const baseUrl = 'http://127.0.0.1:8787';

      function data() {
        return {
          username: '',
          snippet: '',
          previewHtml: '',
          previewHtmlLoading: false,

          submit() {
            if ( ! this.username) {
              alert('Please enter a username.');
              return;
            }

            this.previewHtmlLoading = true;
            this.previewHtml = '';
            this.snippet = getSnippet(this.username);

            fetch(`${baseUrl}?username=${this.username}`)
              .then(response => response.text())
              .then(data => {
                this.previewHtml = data;
                this.previewHtmlLoading = false;
              }).catch(error => {
                this.previewHtml = 'Error loading preview.';
                this.previewHtmlLoading = false;
              })
          }
        }
      }

      function getSnippet(username) {
        return `<div id="letterboxd-embed-wrapper-tc">Loading...</div>
\<script\>
fetch('${baseUrl}?username=${username}')
.then(response => response.text())
.then(data => {
document.getElementById('letterboxd-embed-wrapper-tc').innerHTML = data;
});
\<\/script\>`;
      }
    </script>
  </body>
</html>
